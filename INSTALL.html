<html>
<header>
<title>Installing and Updating Miriad</title>
</header>
<body bgcolor="#FFFFFF">
<center><h1>Installing and updating <em>Miriad</em></h1></center>

<p>
<a href="http://www.atnf.csiro.au/computing/software/miriad"><em>Miriad</em>
</a>, the radio-astronomy data reduction package used by the
<a href="http://www.atnf.csiro.au">ATNF</a>, has been ported to a variety of
<a href="http://en.wikipedia.org/wiki/Unix">unix</a>-based
<a href="http://en.wikipedia.org/wiki/Platform_%28computing%29">platforms</a>.
At the ATNF it runs under
<a href="http://en.wikipedia.org/wiki/Linux">Linux</a> (32- and 64-bit);
<a href="http://en.wikipedia.org/wiki/SunOS">SunOS</a> 5.6 (aka
<a href="http://en.wikipedia.org/wiki/Solaris_Operating_System">Solaris</a>
2.6) and later; and
<a href="http://en.wikipedia.org/wiki/Powerpc">PowerPC</a> and
<a href="http://en.wikipedia.org/wiki/Intel">Intel</a>
<a href="http://en.wikipedia.org/wiki/Macintosh">Macs</a> running
<a href="http://en.wikipedia.org/wiki/Mac_OS_X">Mac OS X</a> 10.4.8 ("Tiger")
which is based on
<a href="http://en.wikipedia.org/wiki/Darwin_%28operating_system%29">
Darwin</a> 8.8.0.  Binary distribution kits are provided for these
platforms.
</p>

<p>
In the past (and present) <em>Miriad</em> has also run under SunOS 4.x,
<a href="http://en.wikipedia.org/wiki/Convex_Computer">ConvexOS</a>,
<a href="http://en.wikipedia.org/wiki/Silicon_Graphics">
SGI</a>/<a href="http://en.wikipedia.org/wiki/IRIX">IRIX</a> (32- and 64-bit),
<a href="http://en.wikipedia.org/wiki/OSF/1">OSF/1</a> (aka Digital UNIX or
Tru64),
<a href="http://en.wikipedia.org/wiki/Hewlett-Packard">
HP</a>/<a href="http://en.wikipedia.org/wiki/HPUX">HPUX</a>,
<a href="http://en.wikipedia.org/wiki/Cray_Inc.">
Cray</a>/<a href="http://en.wikipedia.org/wiki/UNICOS">UNICOS</a>, and the
<a href="http://en.wikipedia.org/wiki/Microsoft_Windows">Windows</a>
<a href="http://en.wikipedia.org/wiki/Cygwin">Cygwin</a> environment
(and it also originally ran on
<a href="http://en.wikipedia.org/wiki/VAX">
VAX</a>/<a href="http://en.wikipedia.org/wiki/VAX/VMS">VMS</a>).  Although
these platforms are not directly supported by ATNF a
GNU-<a href="http://en.wikipedia.org/wiki/Autoconf">autoconf</a>-derived build
system is available for them and other unix-based platforms.
</p>

<p>
<h3>Contents</h3>
<ul>
  <li>
    <a href="#installing">Instructions for installing <em>Miriad</em></a>
    <ul>
      <li><a href="#third-party">Required third-party software</a></li>
      <li><a href="#customising">Customising array sizes</a></li>
      <li><a href="#binary">Installing from a binary distribution</a></li>
      <li><a href="#source">Installing from source code</a></li>
    </ul>
  </li>
  <li>
    <a href="#post-install">Post-installation</a>
  </li>
  <li>
    <a href="#trouble-shooting">Trouble-shooting and system-dependent
    issues</a>
    <ul>
      <li><a href="#loader">Loader reports library not found</a></li>
      <li><a href="#GCC">GNU Fortran and C compilers</a></li>
      <li><a href="#linker">Linker reports unresolved symbols</a></li>
      <li><a href="#LFS">Large File Support (LFS)</a></li>
      <li><a href="#Linux">Linux (32- and 64-bit)</a></li>
      <li><a href="#SunOS">SunOS 5.x (Solaris 2.x)</a></li>
      <li><a href="#Darwin">Darwin / Mac OS X</a></li>
      <li><a href="#Cygwin">Cywin/Windows</a></li>
    </ul>
  </li>
  <li>
    <a href="#updates">Getting regular updates</a>
  </li>
  <li>
    <a href="#structure">The <em>Miriad</em> directory structure</a>
  </li>
</ul>
&nbsp;<br>
<a href="mailto:miriad@atnf.csiro.au"><em>miriad@atnf.csiro.au</em></a>

<hr>
<a name="installing"><h1>Instructions for installing <em>Miriad</em></h1>

<p>
<a href="http://www.atnf.csiro.au/computing/software/miriad"><em>Miriad</em>
</a> is distributed via
<a href="http://en.wikipedia.org/wiki/File_Transfer_Protocol#Anonymous_FTP">
anonymous <code>ftp</code></a> as
<a href="http://en.wikipedia.org/wiki/Gzip"><code>gzip</code></a>'d
<a href="http://en.wikipedia.org/wiki/Tar_%28file_format%29">
<code>tar</code></a> files which are updated weekly.  For convenience the
<a href="http://www.atnf.csiro.au/computing/software/miriad"><em>Miriad
homepage</em></a> contains
<a href="http://en.wikipedia.org/wiki/HTML">hypertext</a> versions of the
<a href="http://www.atnf.csiro.au/computing/software/miriad/userguide/index.html">
<em>User</em></a> and
<a href="http://www.atnf.csiro.au/computing/software/miriad/progguide/index.html">
<em>Programmer Guides</em></a>, and these are also available as separate
<code>gzip</code>'d
<a href="http://en.wikipedia.org/wiki/PostScript">PostScript</a> files (both
forms are included in the distribution).
</p>

<a name="third-party"><h4>Required third-party software</h4>

<p>
<em>Miriad</em> relies on the following third-party software
<a href="http://en.wikipedia.org/wiki/Library_%28computer_science%29">
libraries</a>:
<ul>
<li>
  <p>
  The <a href="http://www.atnf.csiro.au/computing/software/rpfits"><code>
  RPFITS</code> library</a> (currently version 2.16) is used by
  <a href="http://www.atnf.csiro.au/computing/software/miriad/doc/atlod.html">
  <code>atlod</code></a> and a number of other specialized tasks to read the
  ATNF data format.  It is provided in binary installations.
  </p>
</li>

<li>
  <p>
  <a href="http://www.astro.caltech.edu/~tjp/pgplot"><code>PGPLOT</code></a>
  (version 5.0 or later, currently 5.2.2) is used for graphics output by quite
  a number of tasks.  Depending on what graphics drivers it is configured to
  use it may also require other third-party graphics libraries, typically the
  basic <a href="http://en.wikipedia.org/wiki/X11"><code>X11</code></a>
  library (libX11), and also
  <a href="http://www.libpng.org/pub/png/libpng.html">libpng</a> which itself
  requires <a href="http://www.zlib.net/">zlib</a>.
  </p>

  <p>
  <code>PGPLOT</code> uses a number of auxiliary data files
  <code>grfont.dat</code> and <code>rgb.txt</code>, and the display servers
  <code>pgdisp</code> and <code>pgxwin_server</code>.  Everything required is
  provided in binary installations.
  </p>
</li>

<li>
  <p>
  <a href="http://en.wikipedia.org/wiki/LINPACK"><code>LINPACK</code></a> is
  provided with <em>Miriad</em> and will be compiled (in a source-code
  installation) and used unless you explicitly tell it not to.
  </p>
</li>

<li>
  <p>
  <a href="ftp://ftp.gnu.org/pub/gnu/readline/"><code>GNU readline</code></a>
  is used for command-line editing by the
  <a href="http://www.atnf.csiro.au/computing/software/miriad/doc/miriad.html">
  <code>miriad</code> shell</a>.  It requires
  the <code>termcap</code> library which is often included as part of the
  system software but if not the
  <a href="http://www.gnu.org/software/ncurses/ncurses.html">
  <code>ncurses</code> library</a> contains modules that substitute for it.
  </p>
</li>

<li>
  <p>
  Apart from (possibly) being required by <code>PGPLOT</code>,
  <a href="http://en.wikipedia.org/wiki/X11"><code>X11</code></a> is also
  needed to compile the display utilities <code>sxmtv</code>,
  <a href="http://www.atnf.csiro.au/computing/software/miriad/doc/xmtv.html">
  <code>xmtv</code></a>, and <code>xpanel</code>.  The latter two require
  <a href="http://en.wikipedia.org/wiki/Xaw"><code>libXaw</code></a>
  (<a href="http://en.wikipedia.org/wiki/Project_Athena">Athena</a> widgets),
  which in turn requires <code>libXmu</code> (miscellaneous utilities),
  <code>libXext</code> (miscellaneous extensions),
  <a href="http://en.wikipedia.org/wiki/Xt"><code>libXt</code></a> (X toolkit
  intrinsics), and possibly others, such as <code>libXpm</code> (X pixmap),
  <code>libICE</code> (inter-client exchange) and <code>libSM</code> (session
  management) in Linux and Solaris, in addition to the basic
  <code>libX11</code>.
  <p>

  </p>
  All modern unix-based systems should have the <code>X11</code> runtime
  libraries installed as part of the operating system, though if you are
  compiling <em>Miriad</em> from source code, the development libraries and
  header files may need to be installed as an optional extra.  For example, on
  <a href="http://en.wikipedia.org/wiki/Darwin_%28operating_system%29">
  Darwin</a>-based systems these libraries are contained in the
  <code>X11SDK</code> package in the
  <a href="http://en.wikipedia.org/wiki/Xcode"><code>Xcode Tools</code></a>
  software development suite on the installation disk provided by
  <a href="http://en.wikipedia.org/wiki/Apple_Computer">Apple Computer</a>
  (and apparently nowhere else).  On Linux systems it should be enough to
  <a href="http://en.wikipedia.org/wiki/Package_management">install</a>
  <code>libXaw</code> (e.g. with
  <a href="http://en.wikipedia.org/wiki/Advanced_Packaging_Tool">
  <code>apt</code></a>,
  <a href="http://en.wikipedia.org/wiki/Yellow_dog_Updater%2C_Modified">
  <code>yum</code></a>, etc.) since the others will then also be installed
  automatically as dependencies.
  </p>
</li>
</ul>

Of these, most Linux distributions will contain packages for all but
<code>RPFITS</code> which you will probably have to install from source code
unless you can use one of the binary distribution kits.
</p>

<a name="customising"><h4>Customising array sizes</h4>

<p>
One advantage of installing from source code is that it provides an
opportunity to adjust the following parameters in the Fortran include files
<code>$MIR/inc/maxdim.h</code> and <code>tmpdim.h</code> to reflect your
problem sizes and memory availability:
<pre>
	MAXBUF  -- Maximum general scratch buffer size. The value of this
		   is much less critical than you might expect, as most
		   scratch buffers are allocated dynamically.
	MAXDIM  -- Maximum image dimension.
	MAXCHAN -- Maximum number of spectral channels.
	MAXANT  -- Maximum number of antennas.
	MAXBASE -- Maximum number of baselines (normally derived from MAXANT).
	MAXWIN  -- Maximum number of simultaneous frequency bands ("windows").
	MAXWIDE -- Maximum number of wideband channels (Hat Ck specific).
</pre>
No <em>Miriad</em> code allocates memory for arrays of length more than a few
times any of the parameters in <code>maxdim.h</code> (e.g. there are no arrays
of size <code>MAXDIM**2</code>).  <em>Miriad</em> programs mostly allocate
memory dynamically when needed.
</p>

<p>
<code>tmpdim.h</code> is similar to <code>maxdim.h</code> except the values
are invariably set lower because tasks that use it <em>do</em> statically
declare arrays of size <code>MAXDIM**2</code> or similar.
</p>

<p>
Include files may exist within architecture-specific subdirectories of
<code>$MIR/inc</code> and take preference if so; this search-path mechanism
allows multiple architectures to be maintained with a single set of source
code.  For example, since 64-bit systems typically have more memory,
<code>$MIR/inc/linux64/maxdim.h</code> defines larger values of
<code>MAXBUF</code> and <code>MAXDIM</code> for the <code>linux64</code>
architecture and is the relevant one to change on those systems.
</p>

<a name="binary"><h4>Installing from a binary distribution</h4>

<p>
If a
<a href="http://en.wikipedia.org/wiki/Binary_file">binary</a> distribution kit
is available for your
<a href="http://en.wikipedia.org/wiki/Platform_%28computing%29">platform</a>
it is worth trying to install it first.  However, even though the
<code>RPFITS</code> and <code>PGPLOT</code>
<a href="http://en.wikipedia.org/wiki/Library_%28computer_science%29">
libraries</a> are
<a href="http://en.wikipedia.org/wiki/Static_Library">statically</a>
<a href="http://en.wikipedia.org/wiki/Linker">linked</a> there is still a
chance that the
<a href="http://en.wikipedia.org/wiki/Executable">executables</a> may not run
because of incompatibilities between versions of
<a href="http://en.wikipedia.org/wiki/Dynamic_library">dynamic</a> (aka
<a href="http://en.wikipedia.org/wiki/Shared_Library#Shared_library">
shared</a>) system or compiler libraries.  Nevertheless <code>RPFITS</code>
and <code>PGPLOT</code> are supplied and this may save you from having to
install them yourself.
</p>

<p>
Note that if you don't have an account at the ATNF that would allow you to run
<code>mirsync</code> and intend to <a href="#updates">keep your installation
up-to-date</a> by running <code>mirimport</code> then you will have to
<a href="#source">install <em>Miriad</em> from source code</a>.
</p>

<ol>
<li>
  <p>
  Download a copy of the <em>Miriad</em> distribution from
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/">
  ftp://ftp.atnf.csiro.au/pub/software/miriad</a> using your web browser or
  <a href="http://www.gnu.org/software/wget/">wget</a>, or by running
  <a href="http://en.wikipedia.org/wiki/File_Transfer_Protocol">ftp</a> from
  the command line.
  </p>

  <p>
  You will need the common runtime files,
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-common.tar.gz">
  <code>miriad-common.tar.gz</code></a> (which includes catalogues, auxiliary
  data files and also the compiled documentation) and the binaries, which will
  be in a <code>gzip</code>'d <code>tar</code> file with a name like
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-linux.tar.gz">
  <code>miriad-linux.tar.gz</code></a> (others currently are
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-linux64.tar.gz">
  <code>linux64</code></a>,
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-sun4sol.tar.gz">
  <code>sun4sol</code></a>,
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-darwin_ppc.tar.gz">
  <code>darwin_ppc</code></a>, and
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-darwin_x86.tar.gz">
  <code>darwin_x86</code></a>).
  </p>
</li>

<li>
  <p>
  The distribution kits unpack into subdirectory <code>./miriad</code> so if
  you wanted the <em>Miriad</em> root directory to be
  <code>/usr/local/miriad</code>, then you might use something like
<pre>
    % cd /usr/local
    % zcat miriad-common.tar.gz | tar xvf -
    % zcat miriad-linux.tar.gz  | tar xvf -
</pre>
  </p>

  <p>
  Multiple architectures can safely be downloaded and live alongside one
  another without conflict.  Allow about
  <a href="http://en.wikipedia.org/wiki/100_%28number%29">100</a>
  <a href="http://en.wikipedia.org/wiki/MiB">MiB</a> for each binary
  format.
  </p>
</li>

<li>
  <p>
  Install the <em>Miriad</em> initialization scripts.  We use the environment
  variable <code>MIR</code> to indicate the root directory.  Create this, e.g.
<pre>
    % MIR=/usr/local/miriad; export MIR
</pre>
  in <a href="http://en.wikipedia.org/wiki/Bourne_shell">
  <code>sh</code></a>-like shells (e.g. <code>bash</code>, <code>ksh</code>,
  <code>ash</code>, <code>zsh</code>), or
<pre>
    % setenv MIR /usr/local/miriad
</pre>
  in <a href="http://en.wikipedia.org/wiki/C_shell"><code>csh</code></a>-like
  <a href="http://en.wikipedia.org/wiki/Unix_shell">shells</a> (e.g.
  <code>tcsh</code>), then use
<pre>
    % cd $MIR
    % sed -e "s,@MIRROOT@,$MIR," scripts/MIRRC.in > MIRRC
    % sed -e "s,@MIRROOT@,$MIR," scripts/MIRRC.sh.in > MIRRC.sh
    % chmod 644 MIRRC*
</pre>
  This does a
  <a href="http://en.wikipedia.org/wiki/Sed">textual replacement</a> of the
  string "<code>@MIRROOT@</code>" in the template file
  <code>$MIR/scripts/MIRRC.in</code> with the value of <code>$MIR</code> and
  puts the result in <code>MIRRC</code>.  Likewise for <code>MIRRC.sh</code>.
  </p>
</li>
</ol>

<p>
Refer to the <a href="#post-install">post-installation</a> instructions
for initialization and testing.
</p>

<a name="source"><h4>Installing from source code</h4>

<p>
Source code management for ATNF Miriad was completely revised in late 2006.
The old <code>Install</code> script was replaced with a system based on GNU
<code>autoconf</code> and the functions performed by <code>mircadd</code>,
<code>mirclnk</code>, <code>mirfind</code>, <code>mirlibs</code>,
<code>mirnewer</code>, and <code>mirupdate</code>, and related utilities were
subsumed by GNU
<a href="http://en.wikipedia.org/wiki/Make"><code>make</code></a>.  The new
build system implements full dependency analysis, both of sources on included
files, and of executables on static library modules.
</p>

<p>
Most <em>Miriad</em> code is written in fairly standard Fortran 77 and C.
However, both a Fortran and C preprocessor are used to add some simple
language extensions and to aid portability.  These preprocessors are compiled
automatically before any of the <em>Miriad</em> source code.
</p>

<p>
The Fortran preprocessor, <code>ratty</code>, must be applied to all files
with a <code>.for</code> suffix.  It makes VAX-Fortran extensions universally
available, and provides support for conditional compilation directives (little
used) and machine-independent compiler optimisation directives.
<code>ratty</code> output generally differs very little from the input and
looks like fairly vanilla Fortran (with a few VAX extensions).
</p>

<p>
The C preprocessor, <code>intf2c</code>, (which is additional to the normal C
preprocessor) must be applied to all <code>.f2c</code> files.  It's only
purpose is to aid in calling C functions from Fortran; passing standard C
through it simply prepends a few lines.  A special syntax is used for function
declarations and their dummy arguments when these functions are to
be called by Fortran.
</p>

<p>
See the preamble comments of <code>ratty.c</code> and <code>intf2c.c</code>
(in the <code>tools</code> subdirectory) for more information.  It is beyond
the scope of this note to explain how <code>ratty</code> and
<code>intf2c</code> might need to be adapted to support a new architecture.
</p>

<p>
To build <em>Miriad</em> from source code you will need
<ul>
<li>
  <p>
  Either a
  <a href="http://en.wikipedia.org/wiki/Fortran">Fortran</a> 77 compiler such
  as <code>g77</code> or Sun's <code>f77</code>, or a Fortran 95 compiler such
  as
  <a href="http://en.wikipedia.org/wiki/Gfortran"><code>gfortran</code></a>,
  </p>
</li>

<li>
  <p>
  An
  <a href="http://en.wikipedia.org/wiki/ANSI_C">ANSI C</a> compiler such as
  <code>gcc</code> (3.x or 4.x) or Sun's <code>cc</code> (but not
  <code>/usr/ucb/cc</code> - <a href="http://en.wikipedia.org/wiki/K%26R">
  K&amp;R C</a> is not supported and will not work),
  </p>
</li>

<li>
  <p>
  Binary utilities, <code>ar</code>, <code>as</code>, <code>ld</code>, etc.,
  that are compatible with both compilers (usually supplied with them), and
</li>

<li>
  <p>
  GNU <a href="http://en.wikipedia.org/wiki/Make"><code>make</code></a> -
  other variants of <code>make</code> are not supported and <em>will not
  work</em>.  We consistently refer to GNU <code>make</code> as
  <code>gmake</code> and it is often installed under this name, either
  directly or as an alias.  If not, try running
<pre>
    % make --version
</pre>
  and check that it identifies itself as "GNU Make".  If so you might find it
  convenient to create a <code>gmake</code> alias yourself.
  </p>
</li>

<li>
  You may compile the <em>Miriad</em> documentation from its sources if you
  wish, although this is not necessary and not supported as the pre-compiled
  documentation is provided as part of the
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-common.tar.gz">
  <code>miriad-common.tar.gz</code></a> distribution tar file.  To compile it
  you would need the document processing utilities listed in the
  <a href="#step6">generic <code>GNUmakedefs</code></a>.
</li>
</ul>
</p>

<p>
Ideally, once the required compilers, utilities and third-party libraries have
been installed, building <em>Miriad</em> from source code should be as simple
as
<pre>
    % configure
    % gmake
</pre>
However, in practice there are usually a few complications and some manual
tweaking is likely to be required.
</p>

<ol>
<li>
  <p>
  Before anything else you must install the compilers, utilities and
  third-party libraries listed above.  Most Linux systems, and Mac
  Darwin-based systems using
  <a href="http://en.wikipedia.org/wiki/Fink">Fink</a>, will provide
  <a href="http://en.wikipedia.org/wiki/Package_management">packages</a>
  for all but <a href="http://www.atnf.csiro.au/computing/software/rpfits">
  <code>RPFITS</code></a> which you may need to install from source code.
  </p>
</li>

<li>
  <p>
  Download a copy of the <em>Miriad</em> source code distribution from
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/">
  ftp://ftp.atnf.csiro.au/pub/software/miriad</a> using your web browser,
  <a href="http://www.gnu.org/software/wget/">wget</a>, or by running
  <a href="http://en.wikipedia.org/wiki/File_Transfer_Protocol">ftp</a> from
  the command line.
  </p>

  <p>
  You will need the source code,
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-code.tar.gz">
  <code>miriad-code.tar.gz</code></a>, and common runtime files,
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-common.tar.gz">
  <code>miriad-common.tar.gz</code></a>, which includes catalogues, auxiliary
  data files and also the compiled documentation.  (If you're interested, the
  <a href="http://en.wikipedia.org/wiki/Revision_Control_System">
  <code>RCS</code></a> version files are also available in
  <a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-rcs.tar.gz">
  <code>miriad-rcs.tar.gz</code></a>, these will show exactly what changes
  have been made to the source files in recent times.)
  </p>
</li>

<li>
  <p>
  Like most software distribution kits, <em>Miriad</em> unpacks into a
  separate subdirectory, <code>./miriad</code>.  Thus, if you wanted the
  <em>Miriad</em> root directory to be <code>/usr/local/miriad</code> you
  might use something like
<pre>
    % cd /usr/local
    % zcat miriad-code.tar.gz   | tar xvf -
    % zcat miriad-common.tar.gz | tar xvf -
</pre>
  </p>

  <p>
  It is possible to build and maintain multiple architectures alongside one
  another without conflict.  Allow about
  100<a href="http://en.wikipedia.org/wiki/MiB">MiB</a> for each.
  </p>
</li>

<li>
  <p>
  Before running <code>configure</code> check that your architecture is
  recognized by <em>Miriad</em>:
<pre>
    % cd /usr/local/miriad/scripts
    % ./mirarch
</pre>
  If <code>mirarch</code> reports "<code>unknown</code>" you can either leave
  it at that or attempt to provide a more sensible value by appropriate
  editing of <code>mirarch</code> (a simple shell script) - in the next step
  <code>configure</code> will use it to determine the architecture.  Note that
  you will not be able to run multiple architectures if more than one is
  <code>unknown</code>.
  </p>

  <p>
  From now on we will refer to the <em>Miriad</em> root directory as
  <code>$MIR</code> and the architecture reported by <code>mirarch</code> as
  <code>$MIRARCH</code>.  You may find it convenient to create these as
  environment variables.
  </p>
</li>

<li>
  <p>
  Now run <code>configure</code>
<pre>
    % cd $MIR
    % ./configure
</pre>
  If you want to help <code>configure</code> find particular versions of the
  Fortran or C compilers you can set the <code>F77</code> and/or
  <code>CC</code> environment variables before running it (however, note that
  the other options listed by <code>'configure --help'</code> are ignored).
  </p>
</li>

<li>
  <p>
  <a name="step6">
  If you're lucky, this step will involve no work other than checking.
  Otherwise it may require anything from re-defining a few variables to
  installing additional software.
  </p>

  <p>
  Peruse the output generated by <code>configure</code> and address any
  errors or warnings, particularly relating to third-party libraries.  If
  necessary, install compilers or libraries that were not found (if they are
  already installed, just not found, read on).  Try to resolve as many
  problems as possible before proceeding to the next step.  You can re-run
  <code>configure</code> as many times as required.
  </p>

  <p>
  <code>configure</code> produces three files, these are its only product.
  The first two, <code>MIRRC</code> and <code>MIRRC.sh</code>, reside in
  <code>$MIR</code> and are constructed by simple textual replacement of the
  value of the <em>Miriad</em> root directory from the corresponding template
  files (<code>MIRRC.in</code>, etc.) that reside in
  <code>$MIR/scripts</code>.
  </p>

  <p>
  The third and by far the most important file generated by
  <code>configure</code> is <code>$MIR/$MIRARCH/GNUmakedefs</code> (referred
  to as the <b><em>local</em></b> <code>GNUmakedefs</code>).  This is where
  <em>all</em> of the definitions peculiar to your system are made.  You will
  notice that there are other <code>GNUmakedefs</code> files:
  <code>$MIR/GNUmakedefs</code> (the <b><em>generic</em></b>
  <code>GNUmakedefs</code>) contains generic variable definitions and also
  defines rules common to all <em>Miriad</em> makefiles.  Also, if present,
  <code>$MIR/scripts/$MIRARCH/GNUmakedefs</code> may make a few
  <b><em>specialized</em></b> overriding definitions for recognized platforms.
  Every <em>Miriad</em> <code>GNUmakefile</code> reads the generic
  <code>GNUmakedefs</code>, this in turn reads the specialized
  <code>GNUmakedefs</code> (if it exists) and then the local
  <code>GNUmakedefs</code>; each can override variable definitions made
  previously.  However, after including the specialized and local files, the
  generic <code>GNUmakedefs</code> defines further variables that are of a
  fundamental nature and cannot be altered.  Only variables demarked by
  <code>"START OF DEFAULT DEFINITIONS"</code> and <code>"END OF DEFAULT
  DEFINITIONS"</code> in the generic <code>GNUmakedefs</code> can be modified
  in your local <code>GNUmakedefs</code>.
  </p>

  <p>
  If any unresolved problems remain from running <code>configure</code> then
  fix them by editing your local <code>GNUmakedefs</code> appropriately.  For
  example, if you have a library installed in an odd location that
  <code>configure</code> did not guess, then fix it here.  The meaning of each
  variable is explained in the generic <code>GNUmakedefs</code> (which must
  not be modified, read its prologue).  To see what <code>gmake</code> thinks
  the final variable definitions are you can use
<pre>
    % gmake show
</pre>
  from any <em>Miriad</em> directory that contains a <code>GNUmakefile</code>.
  Of the many reported, only those variables relating to compilers and
  libraries should be of any consequence and they are the only ones that can
  be modified.  You may also find
<pre>
    % gmake help
</pre>
  helpful.
  </p>

  <p>
  Check that <code>$MIR/inc/rpfits.inc</code>, delivered with the
  <em>Miriad</em> source code, matches the corresponding file that was (or
  should have been) installed with the <code>RPFITS</code> library.  If not,
  it probably means that your version of <code>RPFITS</code> is stale and you
  will need to update it.
  </p>

  <p>
  If you are porting <em>Miriad</em> to an unrecognized platform, scan the
  generic <code>GNUmakedefs</code> for the string "<code>$(MIRARCH)</code>",
  this will give you a pretty good idea of what is required.  There is usually
  very little to be done, the main distinction is between big- or
  little-endian IEEE floating point formats which is controlled from
  <code>GNUmakedefs</code> via the <em>computed</em> variable
  <code>SUBS$(MIRARCH)</code>, as explained in <code>GNUmakedefs</code>.  The
  preprocessors, <code>ratty</code>, <code>intf2c</code>, and
  <code>cpp</code>, can often be appeased simply by substituting
  <code>$(MIRARCH)</code> with the name of a similar system as is done in
  several of the specialized <code>GNUmakedefs</code> which you can use for
  guidance.  In the worst case you may need to modify <em>Miriad</em> code.
  If so, please report the changes required so that others may benefit from
  them.
  </p>

  <p>
  Once edited your local <code>GNUmakedefs</code> becomes a precious file that
  you should back-up.  If you should happen to re-run <code>configure</code>
  and it finds a pre-existing <code>GNUmakedefs</code> it will preserve it as
  <code>GNUmakedefs.bak</code> (each time) which provides one chance to save
  it.  Preferably you should give your backup copy another name.
  </p>
</li>

<li>
  <p>
  To start the build simply type
<pre>
    % cd $MIR
    % gmake
</pre>
  Compilations are verbose enough to allow you to see the more important
  commands such as compiler invokations.  Problems, if any, will most likely
  arise when the tasks are linked and usually consist of reports of missing
  symbols, sometimes with inscrutible names.  If necessary, and if you can,
  identify the libraries that contain the missing symbols, go back to
  <a href="#step6">step 6</a> and revise <code>GNUmakedefs</code>.  You can
  then safely restart the build and it should compile only what failed the
  previous time.
  </p>

  <p>
  You can invoke <code>gmake</code> in any <em>Miriad</em> directory that
  contains a <code>GNUmakefile</code>, it will recursively rebuild that
  directory and all of its subdirectories.  If for some reason you need to
  force a rebuild from scratch it should be enough to delete the library
<pre>
    % rm -f $MIR/$MIRARCH/lib/libmir.a
</pre>
  If you're really in knots, you can delete all generated files by
<pre>
    % rm -rf $MIR/$MIRARCH/[a-z]*
</pre>
  being careful not to delete your local <code>GNUmakedefs</code>!  If you
  can't locate the source of missing symbols, or encounter some other
  insoluble problem, refer to <a href="#trouble-shooting">trouble-shooting</a>
  below.
  </p>
</li>
</ol>

<p>
Refer to the <a href="#post-install">post-installation</a> instructions
for initialization and testing.
</p>

<hr>

<a name="post-install"><h1>Post-installation</h1>

<p>
A few more steps are required to finalize the installation:
</p>

<ol>
<li>
  <p>
  Define your <em>Miriad</em>
  <a href="http://en.wikipedia.org/wiki/Environment_variable">environment</a>
  by invoking the initialization scripts
<pre>
    % . MIRRC.sh
</pre>
  in <code>sh</code>-like shells, or
<pre>
    % source MIRRC
</pre>
  in <code>csh</code>-like shells.  Among others this will define an
  environment variable called <code>MIRBIN</code> which you should add to your
  <code>PATH</code> environment variable.  Add these commands to your
  <code>.login</code> (for <code>csh</code>) and/or <code>.profile</code>
  (for <code>sh</code>) files to have the environment set up whenever you log
  in.
  </p>
</li>

<li>
  <p>
  Test the installation by running a few tasks from the
  <a href="http://www.atnf.csiro.au/computing/software/miriad/doc/miriad.html">
  <code>miriad</code> shell</a>,
  for example
  <a href="http://www.atnf.csiro.au/computing/software/miriad/doc/atlod.html">
  <code>atlod</code></a> which will test the <code>RPFITS</code> library, and
  <a href="http://www.atnf.csiro.au/computing/software/miriad/doc/uvplt.html">
  <code>uvplt</code></a> which will test <code>PGPLOT</code>, including
  <a href="http://en.wikipedia.org/wiki/X11"><code>X11</code></a>.
  </p>

  <p>
  If there are problems refer to <a href="#trouble-shooting">
  trouble-shooting</a> below.
  </p>

  <p>
  For binary installations, if there are problems that you can't resolve,
  particularly if the <a href="http://en.wikipedia.org/wiki/Dynamic_linker">
  dynamic linker</a> complains about missing symbols, then you may have to
  resort to installing from source code.
  </p>

  <p>
  For source-code installations, if you have problems that can't be resolved
  by repairing <code>GNUmakedefs</code> then you may seek assistance from
  <a href="mailto:miriad@atnf.csiro.au"><code>miriad@atnf.csiro.au</code></a>.
  </p>
</li>

<li>
  <p>
  Finally, register yourself as a <em>Miriad</em> user by sending an email to
  <a href="mailto:miriad@atnf.csiro.au"><code>miriad@atnf.csiro.au</code></a>,
  this allows us to monitor usage wordwide, to send you important update
  notices, and to justify the effort put into distributing and supporting
  <em>Miriad</em> outside the ATNF.  Optionally you can also subscribe to the
  <a href="http://www.atnf.csiro.au/lists/">
  <code>atnf-data-reduction<code></a> and
  <a href="http://www.atnf.csiro.au/lists/"><code>miriad-devel<code></a>
  mailing lists.
  </p>
</li>
</ol>

<hr>

<a name="trouble-shooting"><h1>Trouble-shooting and system-dependent issues</h1>

<ul>
<li>
  <a name="loader"><h4>Loader reports library not found</h4>
  <p>
  This is only likely to be a problem for binary installations.  Although
  statically-linked, the executables still require a small number of
  dynamically-linked system libraries that should be supplied by the operating
  system.  These include <code>readline</code>, <code>ncurses</code>, and
  <code>X11</code>.
  </p>

  <p>
  To determine what dynamic libraries are needed use the <code>ldd</code>
  command on the executable in Linux and Solaris, or <code>'otool -L'</code>
  on Darwin systems.  If any are reported as not found, try to locate them
  somewhere on your system (e.g. look in <code>/usr/local/lib</code>,
  <code>/opt/local/lib</code>, <code>/sw/lib</code>, or other likely place)
  and if found, add that directory to your <code>LD_LIBRARY_PATH</code>
  environment variable, or <code>DYLD_LIBRARY_PATH</code> in Darwin.  If not
  found you will need to install them.
  </p>
</li>

<li>
  <a name="GCC"><h4>GNU Fortran and C compilers</h4>
  <p>
  The
  <a href="http://en.wikipedia.org/wiki/GNU_Compiler_Collection">GNU Fortran
  77 and C compilers</a>, <code>g77</code> and <code>gcc</code>, are
  effectively now the standard for compiling <em>Miriad</em> source code,
  <code>configure</code> will usually find them before any others.  Linux and
  other systems such as Darwin where the GNU compilers are the standard
  usually have the aliases <code>f77</code> and <code>cc</code> set up to
  invoke <code>g77</code> and <code>gcc</code>.
  </p>

  <p>
  You should be aware that there are major differences between versions of the
  GNU compilers, particularly <code>g77</code>.  In particular, we strongly
  recommend against use of version 2.95.x (see <a href="#LFS">Large File
  Support</a> below) in favour of the 3.x series (currently 3.4.x).  To see
  what version you have installed, use
<pre>
    g77 --version
</pre>
  Similarly for gcc.  If you have multiple versions installed (as is often the
  case) you may need to reset the <code>FC</code> and <code>CC</code>
  variables in <code>GNUmakedefs</code> to set a full pathname to select a
  specific version.
  </p>

  <p>
  <code>g77</code> no longer exists in release 4.x of the GNU compiler suite,
  instead replaced by <code>gfortran</code> which is a Fortran 95 compiler.
  <em>Miriad</em> has been built successfully on Darwin systems using
  <code>gfortran</code> 4.1.0 (<code>darwin_ppc</code>) and 4.2.0
  (<code>darwin_x86</code>) in conjunction with <code>gcc</code> 4.x,
  including all third-party Fortran libraries (see
  <a href="#Darwin">Darwin</a> below.)
  </p>

  <p>
  <a name="%VAL">It is sometimes said that <code>gfortran</code> cannot be
  used to compile <code>PGPLOT</code>.  This is incorrect.  The Fortran code
  for certain of the <code>PGPLOT</code> graphics drivers, notably
  <code>GIDRIV</code> (<code>GIF</code> format) and <code>PPDRIV</code>
  (<code>PPM</code>, Portable Pixel Map format), uses the non-standard
  <b><code>%VAL</code></b> construct which, although supported by
  <code>g77</code>, is not recognized by <code>gfortran</code>.  The obvious
  solution is to build <code>PGPLOT</code> without these graphics drivers.
  </p>

  <p>
  For <code>g77</code>, <code>configure</code> should automatically add the
  following compiler flags to the <code>FCSTD</code> variable in your local
  <code>GNUmakedefs</code>:
<pre>
    -ff90-intrinsics-hide -Wno-globals
</pre>
  These may also be set in some of the specialized <code>GNUmakedefs</code>,
  but note that they are not understood by <code>gfortran</code>.  The first
  turns off <code>g77</code>'s knowledge of Fortran 95 intrinsic functions and
  prevents harmless but annoying warnings generated because some
  <em>Miriad</em> routines happen to have the same name as these intrinsics.
  The second suppresses warnings about subroutine argument type mismatches,
  <em>Miriad</em> contains some deliberate mismatches.
  </p>
</li>

<li>
  <a name="linker"><h4>Linker reports unresolved symbols</h4>
  <p>
  Probably the most frequent source of problems is that of the linker not
  being able to resolve all undefined symbols when constructing an executable.
  While this is not the place for a detailed explanation of the way that
  compilers and linkers work, some background knowledge may help in
  understanding and resolving such problems.
  </p>

  <p>
  Modern compilers use special-purpose libraries to implement their functions,
  e.g. for i/o or mathematical calculations.  For example, the
  <a href="http://en.wikipedia.org/wiki/GNU_Compiler_Collection">GNU Fortran
  77 compiler</a>, <code>g77</code>, requires <code>libg2c</code> and
  <code>libgcc</code> at the very least.  It will quietly pass these and
  probably several other libraries to the
  <a href="http://en.wikipedia.org/wiki/Linker">linker</a> (probably called
  <code>collect2</code> in this case) via the <code>-lg2c -lgcc</code> flags,
  whether you specified them or not.  To see just what the compiler is doing,
  create a trivial two-line Fortran program, <code>foo.f</code>
<pre>
          PROGRAM MAIN
          END
</pre>
  and compile it with the flag (typically <code>-v</code>) that causes the
  compiler to be verbose
<pre>
    % g77 -v foo.f
</pre>
  You should get a generous amount of output - thus explaining why the
  compiler is quiet by default!  Look for the <code>-l</code> options passed
  to the linker in the last step, and also take note of the <code>-L</code>
  options that tell the linker where to find the compiler libraries; you will
  notice that these are specific to the version of the compiler.  If you try
  this exercise with different compilers you will find that each requires a
  different set of libraries.  For example, the
  <a href="http://en.wikipedia.org/wiki/GNU_Compiler_Collection">GNU Fortran
  95 compiler</a>, <code>gfortran</code>, requires <code>libgfortran</code> in
  place of <code>libg2c</code>, and Sun's <code>f77</code> requires
  <code>libF77</code>, <code>libM77</code>, and <code>libsunmath</code> and
  none of the GNU libraries.  Ideally, therefore, you should try to use a
  consistent set of compilers for everything.  In practice, however, this may
  be difficult to achieve, particularly if third-party libraries were provided
  as binary installations.
  </p>

  <p>
  Problems may arise when a program is compiled with one compiler but linked
  with a third-party library produced by a different compiler, or possibly a
  different version of the same compiler (though this is rarer).  For example,
  using <code>gfortran</code> to compile a <em>Miriad</em> task and linking it
  to <code>libpgplot</code> that was compiled with <code>g77</code>.  Because
  <code>gfortran</code> will pass <code>-lgfortran</code> to the linker in
  place of <code>-lg2c</code>, various undefined symbols that exist in
  <code>libpgplot</code> will not be satisfied; typically they will have
  inscrutible names.  The solution here is simply to pass <code>-lg2c</code>
  explicitly to the linker.  In this case you might augment the
  <code>PGPLOTLIB</code> variable in <code>GNUmakedefs</code> or possibly the
  <code>XTRNLIBS</code> variable if it applies to a number of libraries.
  </p>

  <p>
  With experience you can learn to associate symbols with particular libraries
  and provide the correct library to the linker via an appropriate entry in
  <code>GNUmakedefs</code>.  Sometimes, however, it can be difficult to locate
  the library that defines them.  The binary utility <code>nm</code> is
  indispensible in this.  Start by running it on the various libraries that
  were specified explicitly on the compile command (<code>-lpgplot</code>,
  <code>-lpng</code>, etc.) to locate the source of the undefined symbol which
  will be marked with <code>U</code> (uppercase, not lower).  Some of the
  symbols should have names that allow you to infer what compiler was used to
  create the library.  Using a trivial program, as above, you can then
  determine what other libraries that compiler requires.  Go through each of
  these using <code>nm</code> to find the one that defines the missing
  symbol which will be marked with <code>T</code> (uppercase, not lower).
  If all else fails you may have to resort to recompiling all third-party
  libraries from source using the same compiler.
  </p>
</li>

<li>
  <a name="LFS"><h4>Large File Support (LFS)</h4>
  <p>
  <a href="http://en.wikipedia.org/wiki/Large_file_support">Large File
  Support</a> (or LFS) means support for reading and writing files larger than
  2<a href="http://en.wikipedia.org/wiki/GiB">GiB</a>.  This is not currently
  handled by <code>configure</code> but instead by hard-coded C-preprocessor
  definitions in some of the specialized <code>GNUmakedefs</code>:
<pre>
    CPPSTD += -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE
</pre>
  If your operating system has LFS then you can add this manually to your
  local <code>GNUmakedefs</code>.  However, note that Darwin 
  <a href="http://developer.apple.com/documentation/Darwin/Reference/Manpages/man3/freopen.3.html">supports files >2GiB natively</a>
  without needing the above C-preprocessor definitions.
  </p>

  <p>
  <font color="#ff0000"><b>One word of warning though:</b></font> if you
  enable LFS be sure to test it carefully.  In particular, in Linux it was
  found that if <code>g77</code> 2.95.4 was used to drive the linker it
  apparently used an incompatible system library with the side-effect that
  <font color="#ff0000"><em>simply opening a file >2GiB was sufficient to
  destroy it</em></font> - the file itself was not deleted only its contents!
  (This was discovered the hard way, the victim was a 50GiB data file that had
  been downloaded over the net!)
  </p>

  <p>
  Also, while most Miriad i/o is done in C which does support 64-bit integer
  types, Miriad tasks are written in Fortran whose INTEGER data type on 32-bit
  machines is only 32-bits.  Thus, for example, the largest file that task
  <code>fits</code> can read or write is 2&sup3;&sup1;-1 bytes in this case.
  If instructed to read a file larger than this <code>fits</code> essentially
  only sees the first 2&sup3;&sup1;-1 bytes and generates error messages
  because of the subsequent inconsistencies.
  </p>
</li>

<li>
  <a name="Linux"><h4>Linux (32- and 64-bit)</h4>
  <p>
  See comments above on GNU compilers.
  </p>

  <p>
  <em>Miriad</em> runs on Linux machines with both 32- and 64-bit addresses.
  This is invisible in the installation process.
  </p>

  <p>
  On a 64-bit machine where the Intel Fortran and C compilers are available,
  <em>Miriad</em> can be built to use 64-bit integers in the Fortran code.
  The advantages of this include access to a bigger address space and
  substantially less chance of integer overflows when counting quantities.  As
  of writing this, the C compiler does not support 64-bit <code>int</code>.
  <em>However, there is some doubt about whether the <code>PGPLOT</code> or
  <code>RPFITS</code> libraries can be built or linked in such an
  environment.</em>  To use the Intel compilers in 64-bit mode, modify the
  <code>MIRRC</code> and <code>MIRRC.sh</code> scripts so that the machine
  architecture is set to <code>linux-ia64</code>.
  </p>
</li>

<li>
  <a name="SunOS"><h4>SunOS 5.x (Solaris 2.x)</h4>
  <p>
  If the Sun compilers have been used to build third-party libraries you may
  find it difficult to use any others (e.g. GNU) to compile <em>Miriad</em>.
  Ensure that the <code>FC</code> and <code>CC GNUmakedefs</code> variables
  refer to the compilers in <code>/opt/SUNWSpro/bin</code> (certainly not
  <code>/usr/ucb/cc</code> which is the K&amp;R C compiler, it does not work).
  Recommended <code>f77</code> compiler options
<pre>
    -libmil -O2
</pre>
  are set in the specialized <code>sun4sol GNUmakedefs</code>,
  <code>-libmil</code> causes certain <code>libm</code> maths routines to be
  inlined for speed.
  </p>

  <p>
  The Sun binary utilities, <code>ar</code>, <code>ld</code>, etc. reside in
  <code>/usr/ccs/bin</code>.
  </p>
</li>

<li>
  <a name="Darwin"><h4>Darwin / Mac OS X</h4>
  <p>
  Problems with unresolved symbols reported by the linker in Darwin may arise
  from having incompatible compilers installed on the system.  The
  Apple-provided GNU compilers, which are installed in <code>/usr/bin</code>
  with libraries in <code>/usr/lib</code>, must be preserved as they are an
  important part of the operating system.  Unfortunately, Apple does not
  currently provide a Fortran compiler in this suite and one must be obtained
  from elsewhere.
  </p>

  <p>
  <code>g77</code> 3.4.3 is available for PowerPC Macs
  (<code>darwin_ppc</code>) and we have used it to compile the
  <code>RPFITS</code> and <code>PGPLOT</code> libraries, the latter in
  particular because <code>gfortran</code> does not support the
  <a href="#%VAL">use of <code>%VAL</code></a> by some of the graphics drivers.
  However, we use <code>gfortran</code> 4.1.0 from the
  <a href="http://pdb.finkproject.org/pdb/package.php/gcc4"><code>gcc4</code>
  Fink package</a> to compile <em>Miriad</em>.  As <a href="#linker">discussed
  above</a>, this requires the addition of <code>-lg2c</code> when linking.
  </p>

  <p>
  <code>g77</code> is not available for Intel Macs (<code>darwin_x86</code>).
  We use the <a href="http://pdb.finkproject.org/pdb/package.php/gcc4">
  <code>gcc4</code> package</a> from the
  <a href="http://fink.sourceforge.net/">Fink project</a> which contains
  version 4.x of the GNU compiler suite, including <code>gfortran</code>
  4.2.0.  However, it is only available in the <em>unstable</em> distribution
  and you may need to
  <a href="http://fink.sourceforge.net/faq/usage-fink.php?phpLang=en#unstable">
  reconfigure Fink</a> to install it.
  </p>

  <p>
  As mentioned, the installation of multiple incompatible compilers is more
  likely to cause problems than not.  The Apple-provided GNU compilers
  installed in <code>/usr/{bin,lib}</code> must be preserved, and the
  Fink-installed compilers in <code>/sw/{bin,lib}</code> are required to
  provide Fortran.  Everything else should be avoided, including DarwinPorts
  installations in <code>/opt/local/{bin,lib}</code> and anything that may
  have been installed from source code in <code>/usr/local/{bin,lib}</code>.
  </p>
</li>
</ul>

<p>
<em>Miriad</em> is known to have been installed on a number of other
platforms, either at the ATNF or elsewhere, but they are
<b><font color="#ff0000"> no longer directly supported by ATNF.</font></b>
We have minimal information on their current status but would be pleased to
add notes provided from elsewhere.
</p>

<ul>
<li>
  <a name="Cygwin"><h4>Cywin/Windows</h4>
  <p>
  <a href="http://en.wikipedia.org/wiki/Cygwin">Cygwin</a> is a Linux-like
  environment layered on top of Windows.  It is quite easy to install on a
  Windows machine, although it can take a while to find all the required
  packages which include all of the compilers, utilities and libraries listed
  above, and probably many more.  They are available from
<pre>
   <a href="http://www.cygwin.com">http://www.cygwin.com</a>
</pre>
  </p>
</li>
</ul>

<hr>

<a name="updates"><h1>Getting regular updates</h1>

<p>
Those with <code>ssh</code> access to an ATNF computer account might consider
using <code>rsync</code> to update their Miriad installation.  Only the
relevant <a href="#structure">subdirectories</a> need be updated from
<code>venice.atnf.csiro.au:/nfs/atapplic/miriad/</code>.  A script,
<code>$MIR/scripts/mirsync</code>, is available that will refresh any files or
subdirectories in <code>$MIR</code> that are present on the master and
<font color="#ff0000"> delete anything it finds within those subdirectories
that is not present on the master.</font>  Use the <code>-d</code> (dry-run)
option to <code>mirsync</code> to see what it would do without actually
changing anything.
</p>

<p>
The full <em>Miriad</em> distribution tar files are regenerated weekly and are
normally ready for collection some time before midnight on Thursday Sydney
time (UTC+1000 in non-daylight-savings months).  It would not be difficult to
write a script to fetch and install these automatically.
</p>

<p>
Incremental source code updates are generated nightly and are usually ready
for collection shortly after 2300 Sydney time.  If you have installed
<em>Miriad</em> from source code you can keep your system up-to-date by
running
<pre>
  % mirimport
</pre>
This uses <code>ftp</code> to fetch the updates from the ATNF, then unpacks
and installs them.  You must then invoke <code>gmake</code> from within
<code>$MIR</code> to rebuild <em>Miriad</em>.
</p>

<p>
You can set this up to run periodically as a <code>cron</code> job which must
<ul>
<li>
  Define the <em>Miriad</em> environment via <code>MIRRC</code> or
  <code>MIRRC.sh</code>.
</li>

<li>
  Add <code>$MIRBIN</code> to the <code>PATH</code> environment variable.
</li>

<li>
  Invoke <code>mirimport</code>.
</li>

<li>
  Invoke <code>gmake</code> from the <em>Miriad</em> root directory.
</li>
</ul>
For example, the crontab entry might look like
<pre>
  30 22 * * 4 . $HOME/.profile ; mirimport && gmake -C $MIR
</pre>
where it is assumed that the <em>Miriad</em> environment and a sensible
<code>PATH</code> are defined in <code>$HOME/.profile</code>.
</p>

<hr>

<a name="structure"><h1>The <em>Miriad</em> directory structure</h1>

<p>
The <em>Miriad</em> runtime system consists of a number of directories that
are common to all architectures (distributed as
<a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-common.tar.gz">
<code>miriad-common.tar.gz</code></a>) and some that are platform-specific.
The latter exist as subdirectories of <code>$MIR/$MIRARCH</code> (otherwise
referred to as <code>$MIRARCHD</code>), where <code>$MIRARCH</code> is the
<em>Miriad</em> platform name, e.g. <code>linux</code>,
<code>darwin_x86</code>, etc.
</p>

<p>
<table>
  <tr valign="top">
    <td width="40"></td>
    <td width="40"><code>$MIR</code></td>
    <td width="40"></td>
    <td width="40"></td>
    <td>Miriad root directory, contains <code>MIRRC</code>,
        <code>PostScript</code> User and Programmer Guides, etc.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/$MIRARCH</code></td>
    <td></td>
    <td>Platform-specific area(s) with names like <code>linux</code>,
        <code>darwin_x86</code>, etc., contains local
	<code>GNUmakedefs</code>.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td></td>
    <td><code>/aux</code></td>
    <td>Files associated with the dependency analysis.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td></td>
    <td><code>/bin</code></td>
    <td>Executables.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td></td>
    <td><code>/lib</code></td>
    <td>Object libraries.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td></td>
    <td><code>/man</code></td>
    <td>Unix manual pages.  The <code>man1</code> subdirectory may be set up
        as a symlink to <code>$MIR/man/man1/</code>.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td></td>
    <td><code>/tmp</code></td>
    <td>Temporary area used when compiling.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/cat</code></td>
    <td></td>
    <td>Source and emission line catalogues, antenna location files,
        observatory coordinate database, etc.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/doc</code></td>
    <td></td>
    <td><code>doc</code> files (online help) for each task.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/html</code></td>
    <td></td>
    <td><code>doc</code> files, User and Programmer Guides converted to
        <code>HTML</code> form.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/man</code></td>
    <td></td>
    <td><code>doc</code> files converted to Unix man pages.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/scripts</code></td>
    <td></td>
    <td>Utility scripts, the most important being <code>mirarch</code>.
        Platform-specific subdirectories contain specialized
	<code>GNUmakedefs</code>.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/specdoc</code></td>
    <td></td>
    <td>"Special" <code>doc</code> files, not associated with a particular
        task (<code>cheat</code>, <code>help</code>, <code>miriad</code>,
        <code>tasks</code>, etc.).</td>
  </tr>
</table>
</p>

<p>
<em>Miriad</em> source code and utilities (distributed as
<a href="ftp://ftp.atnf.csiro.au/pub/software/miriad/miriad-code.tar.gz">
<code>miriad-code.tar.gz</code></a>) exist in the following directories:
<table>
  <tr valign="top">
    <td width="40"></td>
    <td width="40"><code>$MIR</code></td>
    <td width="40"></td>
    <td width="40"></td>
    <td>Miriad root directory, contains generic <code>GNUmakedefs</code> and
        top-level <code>GNUmakefile</code>.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/guides</code></td>
    <td></td>
    <td>LaTeX source and several utilities for compiling the User and
        Programmer Guides.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/inc</code></td>
    <td></td>
    <td>Commonly-used Fortran and C include files.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/linpack</code></td>
    <td></td>
    <td><code>LINPACK</code> source code.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/prog</code></td>
    <td></td>
    <td>Fortran source code for <em>Miriad</em> tasks.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/spec/*</code></td>
    <td></td>
    <td>Source code for special-case utilities, the main ones being the
        <code>xmtv</code> and <code>xpanel</code>.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/subs</code></td>
    <td></td>
    <td>Source code, mainly Fortran but some C, for the <em>Miriad</em>
        library.  Platform-specific variants of a few source files are
	contained in subdirectories.</td>
  </tr>
  <tr valign="top">
    <td></td>
    <td></td>
    <td><code>/tools</code></td>
    <td></td>
    <td>C source code for <em>Miriad</em> tools, including the
        <code>miriad</code> shell, <code>intf2c</code> and <code>ratty</code>
	preprocessors, and utilities for extracting documentation from source
	code and reformatting it.</td>
  </tr>
</table>

<hr>

<p>
<small>$Id$</small>
</p>
